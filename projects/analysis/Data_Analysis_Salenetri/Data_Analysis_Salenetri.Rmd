---
title: "Data_Analysis_Salenetri"
author: "Mia Salenetri"
date: "11/4/2019"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## R Markdown


```{r}
install.packages("tidycensus")
install.packages("arcos")
install.packages("tidyverse")
install.packages("janitor")
install.packages("scales")
install.packages("ggrepel")
```

```{r}
library(tidyverse)
library(tidycensus)
library(arcos)
library(janitor)
library(scales)
library(ggrepel)
library(dplyr)
options(scipen = 0)
```

```{r}
ARCOSkey <- "uO4EK6I"
```

Because I'm having trouble working on some of the actual coding aspects, I'm going to start by writing out what I intend to do once I have the tools I need to start my analysis.

Using the nine rural/urban population groups determined by the USDA, I want to determine whether different demographic groups are affected differently based on the size of a metro area.

First, I want to import the datasets I'll need:
 - ARCOS pills per person per county 
 - the USDA rural urban county codes and populations (done)
 - the opioid death rates by county (done)
 - Census demographic data by county for race/ethnicity and economic class (waiting for API key)
 
```{r}
#set CENSUSkey
#load census data
#load county geometric data (load shapefiles, lab 7)
```
 
I'll need to normalize all the datasets so they are easier to join together. Many of them are formatted differently and I'll likely have to do a lot of mutations to make them easier to handle.
For example, I'll need to make sure that I split up the FIPS codes so there's a column for state_FIPS and county_FIPS. I also want to make sure every dataset has two separate columns for state and county. Some datasets have the word "county" in the county column, so I'll need to find a way to remove the word "county." 
```{r}
#split fips
#remove the word county
#normalize into all caps? probably
```

Before I do much analysis with the UDSA data, I want to create a color-coded map that visualizes the sizes of metro areas.
```{r}
#metro area map
```


Instead of working with the differences by year, I want to just use the averages across 2006-12. This means I'll need to alter the ARCOS dataset to show the average amount of pills per person from 2006-12 and the total opioid deaths from 2006-12 by county. Before I've done any work I've noticed that a lot of inputs for "deaths" in opioid_deaths_06_12 are "suppressed." I'm not sure what this means but I assume that I won't have death data for every county. In the end though, I think this won't be an issue as I can use the trends from the counties I do have data for to make an educated guess/inference about that size of metro center.
```{r}
#total number of pills from 2006-2012 categorized by the countyfips code:
arcos_county_pills_per_year <- summarized_county_annual(key = ARCOSkey) %>%
  clean_names()
arcos_county_totals <- arcos_county_pills_per_year %>%
  group_by(countyfips) %>%
  mutate(Total_pills =sum(dosage_unit)) %>%
  summarise(Total_pills = sum(Total_pills))

#total deaths by county from 2006-2012:

```

Join the newly simplified arcos_county_totals with the ruralurbancodes2013 into new rural_urban_working. It will now contain the countyfips, state, county name, population, urban group and pill totals.
```{r}
#changing column names and removing unnecessary columns
rural_urban_working <- ruralurbancodes2013 %>%
  mutate(countyfips = FIPS) %>%
  select(-FIPS) %>%
  select(-Description) %>%
  select(-X7) %>%
  select(-X8) 

#joining the two tables 
rural_urban_working <- rural_urban_working %>%
  inner_join(arcos_county_totals, by = NULL, copy = FALSE)

#adding pills per person column
rural_urban_working <- rural_urban_working %>%
  mutate(Pills_per_person = Total_pills / Population_2010 )

```

Now, join the census demographic dataset and the USDA population/metro size dataset. Instead of looking at the racial makeup and socioeconomic class for each county, I want to use the median incomes and racial makeups by size of metro area. For example, I want to say that the median household income for a county in a nonmetro area with an urban population of 20,000 or more is X. 
```{r}
#join census demographics with USDA population and metro area group
```

While I won't be able to open it on my personal computer, I want to have a massive dataset that is a combination of all the data I could ever need
```{r}
#start with ARCOS pill totals by county (county, state, fips, dosage unit) 
#then add the demographics for each county (race/ethnicity and median income)
#then add populations and RU codes for each county
#then add optoid deaths for each county
```




